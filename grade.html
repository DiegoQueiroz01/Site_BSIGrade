<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grade Curricular - BSI</title>
    <link rel="stylesheet" href="grade.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body id="grade">
    <div class="container-fluid">
        <h2 class="titulo-grade">Grade Curricular - BSI</h2>
        
        <div class="container mt-4">
            <div class="progress-container">
                <span class="progress-text">Progresso do Curso: <span id="porcentagem">0%</span></span>
                <div class="progress-bar-bg">
                    <div id="progresso-fill" class="progress-bar-fill"></div>
                </div>
                <small class="text-white-50">
                    <span id="concluidas">0</span> de <span id="total">0</span> matérias
                </small>
            </div>
        </div>

        <div class="grade-scroll">
            <div class="semestre-coluna">
                <div class="semestre-titulo">1º Semestre</div>
                <div class="materias-wrapper">
                    <div class="materia-card" id="AP">Algoritmos e Programação</div>
                    <div class="materia-card" id="LPGA">Linguagem e Produção de Gêneros Textuais</div>
                    <div class="materia-card" id="FSI">Fundamentos de Sistemas de Informação</div>
                    <div class="materia-card" id="MD1">Matemática Discreta I</div>
                    <div class="materia-card" id="ICC">Introdução à Ciência da Computação</div>
                    <div class="materia-card" id="IAC">Inglês Aplicado à Computação</div>
                </div>
            </div>

            <div class="semestre-coluna">
                <div class="semestre-titulo">2º Semestre</div>
                <div class="materias-wrapper">
                    <div class="materia-card" id="LP1" data-requisito="AP">Linguagem de Programação I</div>
                    <div class="materia-card" id="OAC">Organização e Arquitetura de Computadores</div>
                    <div class="materia-card" id="CES">Computador, Ética e Sociedade</div>
                    <div class="materia-card" id="MD2" data-requisito="MD1">Matemática Discreta II</div>
                    <div class="materia-card" id="CALC1" data-requisito="MD1">Cálculo Diferencial Aplicado à Computação</div>
                    <div class="materia-card" id="ADM">Administração</div>
                </div>
            </div>

            <div class="semestre-coluna">
                <div class="semestre-titulo">3º Semestre</div>
                <div class="materias-wrapper">
                    <div class="materia-card" id="LP2" data-requisito="LP1">Linguagem de Programação II</div>
                    <div class="materia-card" id="ED" data-requisito="LP1">Estrutura de Dados</div>
                    <div class="materia-card" id="SO" data-requisito="OAC">Sistemas Operacionais</div>
                    <div class="materia-card" id="PE">Probabilidade e Estatística</div>
                    <div class="materia-card" id="DC">Direito Cibernético</div>
                    <div class="materia-card" id="OSM" data-requisito="ADM">Organização, Sistemas e Metódos</div>
                </div>
            </div>

            <div class="semestre-coluna">
                <div class="semestre-titulo">4º Semestre</div>
                <div class="materias-wrapper">
                    <div class="materia-card" id="MPC">Metodologia de Pesquisa Científica</div>
                    <div class="materia-card" id="AMS">Análise e Modelagem de Sistemas</div>
                    <div class="materia-card" id="BD1" data-requisito="LP1">Banco de Dados I</div>
                    <div class="materia-card" id="RC" data-requisito="SO">Redes de Computadores</div>
                    <div class="materia-card" id="WEB1" data-requisito="LP2">Programação para Web I</div>
                    <div class="materia-card" id="EMP" data-requisito="ADM">Empreendedorismo</div>
                    <div class="materia-card" id="ACEXI">ACEX I</div>
                </div>
            </div>

            <div class="semestre-coluna">
                <div class="semestre-titulo">5º Semestre</div>
                <div class="materias-wrapper">
                    <div class="materia-card" id="ECON">Economia</div>
                    <div class="materia-card" id="PDS" data-requisito="AMS">Processo de Desenvolvimento de Software</div>
                    <div class="materia-card" id="CA" data-requisito="ED">Complexidade de Algoritmos</div>
                    <div class="materia-card" id="BD2" data-requisito="BD1">Banco de Dados II</div>
                    <div class="materia-card" id="PAR" data-requisito="RC">Projeto e Administração de Redes</div>
                    <div class="materia-card" id="WEB2" data-requisito="WEB1">Programação para Web II</div>
                    <div class="materia-card" id="ACEXII" data-requisito="ACEXI">ACEX II</div>
                </div>
            </div>

            <div class="semestre-coluna">
                <div class="semestre-titulo">6º Semestre</div>
                <div class="materias-wrapper">
                    <div class="materia-card" id="IA" data-requisito="LP2 MD2">Inteligência Artificial</div>
                    <div class="materia-card" id="PDM" data-requisito="PDS">Programação para Dispositivos Móveis</div>
                    <div class="materia-card" id="ES" data-requisito="PSD">Engenharia de Software</div>
                    <div class="materia-card" id="SD" data-requisito="PAR">Sistemas Distribuídos</div>
                    <div class="materia-card" id="SF" data-requisito="BD1 RC">Segurança da Informação</div>
                    <div class="materia-card" id="GP" data-requisito="ADM PDS">Gestão de Projetos</div>
                    <div class="materia-card" id="ACEXIII" data-requisito="ACEXII">ACEX III</div>
                </div>
            </div>

            <div class="semestre-coluna">
                <div class="semestre-titulo">7º Semestre</div>
                <div class="materias-wrapper">
                    <div class="materia-card" id="DDI" data-requisito="PDS SD">Desenvolvimento Distribuído na Internet</div>
                    <div class="materia-card" id="QS" data-requisito="ES">Qualidade de Software</div>
                    <div class="materia-card" id="TCC1">Trabalho de Conclusão de Curso I</div>
                    <div class="materia-card" id="IHM" data-requisito="ES">Interface Homem-Máquina</div>
                    <div class="materia-card" id="SAD" data-requisito="GP">Sistema de Apoio à Decisão</div>
                    <div class="materia-card" id="OP1">Optativa A</div>
                    <div class="materia-card" id="ACEXIV" data-requisito="ACEXIII">ACEX IV</div>
                </div>
            </div>

            <div class="semestre-coluna">
                <div class="semestre-titulo">8º Semestre</div>
                <div class="materias-wrapper">
                    <div class="materia-card" id="MA">Meio Ambiente</div>
                    <div class="materia-card" id="GG" data-requisito="GP SF">Gestão e Governança de TI</div>
                    <div class="materia-card" id="TCC2" data-requisito="TCC1">Trabalho de Conclusão de Curso II</div>
                    <div class="materia-card" id="OP2">Optativa B</div>
                    <div class="materia-card" id="OP3">Optativa C</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="requisito.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Configurações do seu Firebase (conforme imagem e1302b)
        const firebaseConfig = {
            apiKey: "AIzaSyDHn3Dl-WbBR-JJ2f_uaxosGcWZvDFVKEc",
            authDomain: "grade-curricular-bsi.firebaseapp.com",
            projectId: "grade-curricular-bsi",
            storageBucket: "grade-curricular-bsi.appspot.com",
            messagingSenderId: "951972844111",
            appId: "1:951972844111:web:53820e6a8770857100465c"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const matriculaAtiva = localStorage.getItem('matricula_logada');
        const materiasCards = document.querySelectorAll('.materia-card');
        let dadosDoAluno = {}; 

        if (!matriculaAtiva) {
            window.location.href = "index.html";
        }

        async function carregarDados() {
            const docRef = doc(db, "alunos", matriculaAtiva);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                dadosDoAluno = docSnap.data();
            }
            renderizarGrade();
        }

        async function salvarDados() {
            const docRef = doc(db, "alunos", matriculaAtiva);
            await setDoc(docRef, dadosDoAluno);
        }

        function renderizarGrade() {
            let concluidasCount = 0;
            const totalMaterias = materiasCards.length;

            materiasCards.forEach(card => {
                const id = card.id;
                if (!id) return; 

                const info = dadosDoAluno[id] || { concluida: false };

                if (info.concluida) {
                    card.classList.add('materia-concluida');
                    concluidasCount++;
                } else {
                    card.classList.remove('materia-concluida');
                }
            });

            const porc = totalMaterias > 0 ? Math.round((concluidasCount / totalMaterias) * 100) : 0;
            document.getElementById('progresso-fill').style.width = porc + '%';
            document.getElementById('porcentagem').innerText = porc + '%';
            document.getElementById('concluidas').innerText = concluidasCount;
            document.getElementById('total').innerText = totalMaterias;
        }

        materiasCards.forEach(card => {
            card.addEventListener('click', async () => {
                const id = card.id;
                if (!id) return;
                
                if (!dadosDoAluno[id]) {
                    dadosDoAluno[id] = { concluida: true };
                } else {
                    dadosDoAluno[id].concluida = !dadosDoAluno[id].concluida;
                }
                
                renderizarGrade();
                await salvarDados();
            });
        });

        carregarDados();
    </script>
</body>
</html>